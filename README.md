# seckill-demo
基于SpringBoot+MybatisPlus+Redis+RabbitMQ实现的秒杀商城Demo

## 项目搭建：

1. 技术栈SpringBoot+MybatisPlus
2. 集成Redis+RabbitMQ
3. 数据库使用mybtisPlus逆向工程生成对应表（t_user，t_goods，t_order,t_seckill_goods,t_seckill_order）各层模型

## 项目功能：

- 登录功能
- 商品列表展示
- 商品详情页面
- 秒杀商品
- 订单信息页面

## 功能优化：

1. 登录功能：

   密码进行两次MD5加密，前端传给后端固定盐值加密，
   传到数据库随机盐值二次加密。

2. 参数校验：

   通过validation组件，对手机号码等属性的格式进行参数校验
   @Valid接受vo对象，@NotNull非空，@Length长度
   @自定义注解，定义一个自定义校验规则的类，
   实现ConstraintValidator接口，重写initialize和isValid方法。

3. 异常信息处理：

   使用全局异常处理将抛出的异常的信息显示在页面上，
   使用@ControllerAdvice和@ExceptionHandler组合注解实现。

4. 分布式session问题：

   使用Redis存储用户登录信息，解决分布式session问题。

5. 用户信息校验优化：

   大部分接口都需要做用户校验，自定义用户参UserArgumentResolver，
   配合拦截器将用户信息存入Threadlocal中，保证用户信息线程私有，
   每次Controller入参前就做好了用户参数信息校验然后再入Controller。

6. 页面静态化：

   商品详情页面静态化、秒杀静态化、订单页面静态化。静态化的处理就是将静态资源剔除，后端只返回数据对象，通过ajax异步调用获取，可用前后端分离代替。

7. 数据库索引优化：

   1. 设置数据库订单表中用户ID和商品ID的唯一索引，解决同一用户重复抢购问题。
   2. 优化sql语句，判断库存数量，解决库存超卖问题。
   3. 针对于秒杀的高并发，仅使用缓存无法很好的解决，实际压测对比。

## 接口优化：

1. 通过Redis预减库存，减少数据库访问（系统初始化时，把商品库存数量加载到Redis，收到请求通过Redis进行预减库存）。
2. 内存标记，减少对Redis服务器的访问。
3. 下单优化，请求进入队列缓存，异步下单，RabbitMQ（收到下单请求，放入RabbitMQ消息队列，异步生成订单，减少数据库库存）。
4. 客户端轮询查询秒杀结果，是否生成订单。

## 安全优化：

1. 隐藏秒杀的接口地址，HTTP明文传输，避免秒杀地址泄露（通过接口获取秒杀接口的地址，再根据秒杀地址进行秒杀）。
2. 对获取秒杀地址的接口生成验证码，隔离脚本，分散请求的时间长度。
3. 接口限流防刷（限制每个用户在一定时间内最多请求几次，超过次数进行限流），主要做法通过拦截器配合自定义注解优化计数器算法完成限流，减少业务代码的入侵。

减少数据库访问<->提高数据库性能（MyCat、分库分表）
